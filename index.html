<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual RLC Circuit Lab - Interactive Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #0f172a, #1e293b, #334155, #475569);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #f8fafc;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .lab-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 20px;
            border: 2px solid #3b82f6;
        }
        
        .lab-header h1 {
            font-size: 3em;
            color: #60a5fa;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(96, 165, 250, 0.5);
        }
        
        .lab-header p {
            font-size: 1.2em;
            color: #cbd5e1;
        }
        
        .lab-workspace {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
            min-height: 600px;
        }
        
        .instrument-panel {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid #3b82f6;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }
        
        .function-generator {
            border-color: #10b981;
        }
        
        .oscilloscope {
            border-color: #f59e0b;
        }
        
        .instrument-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
        }
        
        .fg-title {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
        }
        
        .dso-title {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: white;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #d1d5db;
            font-weight: 600;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            background: #4b5563;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 10px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #3b82f6, #60a5fa);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(59, 130, 246, 0.5);
        }
        
        .value-display {
            background: #1f2937;
            color: #3b82f6;
            padding: 8px 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 1.1em;
            text-align: center;
            border: 1px solid #3b82f6;
        }
        
        .waveform-select {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .wave-btn {
            background: #4b5563;
            border: 2px solid #6b7280;
            color: #d1d5db;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .wave-btn.active {
            background: #10b981;
            border-color: #34d399;
            color: #f8fafc;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        
        .circuit-area {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #7c3aed;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .circuit-title {
            background: linear-gradient(45deg, #7c3aed, #5b21b6);
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
        }
        
        .circuit-builder {
            background: #1f2937;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px dashed #7c3aed;
            min-height: 300px;
            position: relative;
        }
        
        .breadboard {
            background: linear-gradient(45deg, #065f46, #047857);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #10b981;
            position: relative;
            min-height: 200px;
        }
        
        .connection-point {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #1f2937;
        }
        
        .input-terminal {
            background: #dc2626;
            top: 20px;
            left: 20px;
        }
        
        .output-terminal {
            background: #dc2626;
            top: 20px;
            right: 20px;
        }
        
        .ground-terminal {
            background: #1f2937;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .connection-point:hover {
            transform: scale(1.3);
            box-shadow: 0 0 15px currentColor;
        }
        
        .cable {
            position: absolute;
            height: 4px;
            border-radius: 2px;
            transition: all 0.5s;
            z-index: 10;
        }
        
        .cable-red {
            background: linear-gradient(90deg, #dc2626, #ef4444);
            box-shadow: 0 0 10px rgba(220, 38, 38, 0.5);
        }
        
        .cable-black {
            background: linear-gradient(90deg, #1f2937, #374151);
            box-shadow: 0 0 10px rgba(31, 41, 55, 0.5);
        }
        
        .component-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .component-btn {
            background: #374151;
            border: 2px solid #6b7280;
            color: #d1d5db;
            padding: 15px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
        }
        
        .component-btn.active {
            background: #7c3aed;
            border-color: #a855f7;
            color: #f8fafc;
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
        }
        
        .component-values {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .scope-display {
            background: #000;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #f59e0b;
            position: relative;
            height: 300px;
        }
        
        .scope-screen {
            width: 100%;
            height: 100%;
            border-radius: 5px;
            background: #001122;
        }
        
        .scope-controls {
            margin-top: 20px;
        }
        
        .scope-measurements {
            background: #1f2937;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #f59e0b;
        }
        
        .measurement-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .measurement-item {
            color: #00ff00;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .power-btn {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .fg-power {
            background: #10b981;
            color: white;
        }
        
        .fg-power:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .dso-power {
            background: #f59e0b;
            color: white;
        }
        
        .dso-power:hover {
            background: #d97706;
            transform: translateY(-2px);
        }
        
        .analysis-panel {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid #8b5cf6;
            margin-top: 30px;
        }
        
        .analysis-title {
            background: linear-gradient(45deg, #8b5cf6, #7c3aed);
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .analysis-card {
            background: rgba(139, 92, 246, 0.1);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #8b5cf6;
            text-align: center;
        }
        
        .analysis-value {
            font-size: 2em;
            font-weight: bold;
            color: #a855f7;
            margin-bottom: 10px;
        }
        
        .analysis-label {
            color: #cbd5e1;
            font-weight: 600;
        }
        
        @media (max-width: 1200px) {
            .lab-workspace {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .lab-header h1 {
                font-size: 2.5em;
            }
            
            .component-selector,
            .component-values,
            .waveform-select {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .measurement-grid {
                grid-template-columns: 1fr;
            }
            
            .instrument-panel {
                padding: 20px;
            }
            
            .circuit-area {
                padding: 20px;
            }
        }
        
        .component-symbol {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-on {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }
        
        .status-off {
            background: #6b7280;
        }
        
        .lab-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .lab-info h4 {
            color: #60a5fa;
            margin-bottom: 10px;
        }
        
        .theoretical-display {
            background: #1f2937;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #6b7280;
        }
        
        .theoretical-display h5 {
            color: #10b981;
            margin-bottom: 10px;
        }
        
        .formula {
            font-family: monospace;
            background: #374151;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="lab-header">
            <h1>ðŸ”¬ Virtual RLC Circuit Laboratory</h1>
            <p>Interactive Circuit Analysis with Function Generator and Digital Storage Oscilloscope</p>
            <div style="margin-top: 15px;">
                <span class="status-indicator status-on"></span>Function Generator
                <span style="margin: 0 20px;">âš¡</span>
                <span class="status-indicator status-on"></span>Circuit Under Test
                <span style="margin: 0 20px;">âš¡</span>
                <span class="status-indicator status-on"></span>Digital Storage Oscilloscope
            </div>
        </div>

        <div class="lab-workspace">
            <!-- Function Generator -->
            <div class="instrument-panel function-generator">
                <div class="instrument-title fg-title">ðŸ“¡ Function Generator</div>
                
                <div class="control-group">
                    <label>Waveform Type:</label>
                    <div class="waveform-select">
                        <button class="wave-btn active" onclick="selectWaveform('sine')">Sine</button>
                        <button class="wave-btn" onclick="selectWaveform('square')">Square</button>
                        <button class="wave-btn" onclick="selectWaveform('triangle')">Triangle</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label>Frequency</label>
                    <input type="range" class="slider" id="freq-slider" min="1" max="10000" value="1000" step="1">
                    <div class="value-display" id="freq-display">1000 Hz</div>
                </div>
                
                <div class="control-group">
                    <label>Amplitude</label>
                    <input type="range" class="slider" id="amp-slider" min="0.1" max="10" value="5" step="0.1">
                    <div class="value-display" id="amp-display">5.0 V</div>
                </div>
                
                <div class="control-group">
                    <label>DC Offset</label>
                    <input type="range" class="slider" id="offset-slider" min="-5" max="5" value="0" step="0.1">
                    <div class="value-display" id="offset-display">0.0 V</div>
                </div>
                
                <button class="power-btn fg-power" onclick="toggleFGPower()">
                    <span class="status-indicator status-on"></span>OUTPUT ON
                </button>
                
                <div class="lab-info">
                    <h4>Output Status</h4>
                    <div style="font-family: monospace; color: #10b981;">
                        <div>CH1: <span id="fg-status">ACTIVE</span></div>
                        <div>Load: <span id="fg-load">50Î©</span></div>
                    </div>
                </div>
            </div>

            <!-- Circuit Area -->
            <div class="circuit-area">
                <div class="circuit-title">ðŸ”§ Circuit Under Test</div>
                
                <div class="component-selector">
                    <button class="component-btn active" onclick="selectCircuitType('rlc')" data-type="rlc">
                        <div class="component-symbol">âš¡</div>RLC Series
                    </button>
                    <button class="component-btn" onclick="selectCircuitType('rc')" data-type="rc">
                        <div class="component-symbol">ðŸ”‹</div>RC Filter
                    </button>
                    <button class="component-btn" onclick="selectCircuitType('rl')" data-type="rl">
                        <div class="component-symbol">ðŸŒ€</div>RL Filter
                    </button>
                </div>
                
                <div class="component-values">
                    <div class="control-group">
                        <label>Resistance (Î©)</label>
                        <input type="range" class="slider" id="resistance-slider" min="1" max="10000" value="1000" step="1">
                        <div class="value-display" id="resistance-display">1000 Î©</div>
                    </div>
                    <div class="control-group">
                        <label>Inductance (mH)</label>
                        <input type="range" class="slider" id="inductance-slider" min="0.1" max="100" value="10" step="0.1">
                        <div class="value-display" id="inductance-display">10.0 mH</div>
                    </div>
                    <div class="control-group">
                        <label>Capacitance (Î¼F)</label>
                        <input type="range" class="slider" id="capacitance-slider" min="0.01" max="100" value="1" step="0.01">
                        <div class="value-display" id="capacitance-display">1.00 Î¼F</div>
                    </div>
                </div>
                
                <div class="breadboard">
                    <div class="connection-point input-terminal" title="Input Terminal"></div>
                    <div class="connection-point output-terminal" title="Output Terminal"></div>
                    <div class="connection-point ground-terminal" title="Ground"></div>
                    
                    <!-- Cables -->
                    <div class="cable cable-red" id="input-cable" style="top: 27px; left: 35px; width: 100px;"></div>
                    <div class="cable cable-black" id="ground-cable-in" style="bottom: 27px; left: 35px; width: 100px;"></div>
                    <div class="cable cable-red" id="output-cable" style="top: 27px; right: 35px; width: 100px;"></div>
                    <div class="cable cable-black" id="ground-cable-out" style="bottom: 27px; right: 35px; width: 100px;"></div>
                    
                    <!-- Circuit Components Visualization -->
                    <div id="circuit-diagram" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-weight: bold; text-align: center;">
                        <div style="background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px;">
                            <div id="circuit-type">RLC Series Circuit</div>
                            <div id="circuit-values" style="font-size: 0.9em; margin-top: 5px;">R=1kÎ©, L=10mH, C=1Î¼F</div>
                        </div>
                    </div>
                </div>
                
                <div class="theoretical-display">
                    <h5>Circuit Analysis</h5>
                    <div class="formula">fâ‚€ = 1/(2Ï€âˆšLC) = <span id="resonant-freq">159 Hz</span></div>
                    <div class="formula">Z = âˆš(RÂ² + (Ï‰L - 1/Ï‰C)Â²) = <span id="impedance">1.58 kÎ©</span></div>
                    <div class="formula">Ï† = arctan((Ï‰L - 1/Ï‰C)/R) = <span id="phase-angle">-45Â°</span></div>
                </div>
            </div>

            <!-- Digital Storage Oscilloscope -->
            <div class="instrument-panel oscilloscope">
                <div class="instrument-title dso-title">ðŸ“Š Digital Storage Oscilloscope</div>
                
                <div class="scope-display">
                    <canvas class="scope-screen" id="scope-canvas" width="300" height="250"></canvas>
                    <div style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; color: #00ff00; font-family: monospace; font-size: 0.8em;">
                        <div>CH1: <span style="color: #00ff00;">â– </span> Input</div>
                        <div>CH2: <span style="color: #ff6600;">â– </span> Output</div>
                        <div>Timebase: <span id="timebase-display">1ms/div</span></div>
                    </div>
                </div>
                
                <div class="scope-controls">
                    <div class="control-group">
                        <label>Time/Div</label>
                        <input type="range" class="slider" id="timebase-slider" min="1" max="1000" value="100" step="1">
                        <div class="value-display" id="timebase-value">100 Î¼s/div</div>
                    </div>
                    
                    <div class="control-group">
                        <label>CH1 V/Div</label>
                        <input type="range" class="slider" id="ch1-scale" min="0.1" max="5" value="2" step="0.1">
                        <div class="value-display" id="ch1-scale-display">2.0 V/div</div>
                    </div>
                    
                    <div class="control-group">
                        <label>CH2 V/Div</label>
                        <input type="range" class="slider" id="ch2-scale" min="0.1" max="5" value="2" step="0.1">
                        <div class="value-display" id="ch2-scale-display">2.0 V/div</div>
                    </div>
                </div>
                
                <button class="power-btn dso-power" onclick="toggleDSOPower()">
                    <span class="status-indicator status-on"></span>ACQUISITION ON
                </button>
                
                <div class="scope-measurements">
                    <h4 style="color: #f59e0b; margin-bottom: 10px;">Measurements</h4>
                    <div class="measurement-grid">
                        <div class="measurement-item">CH1 Freq: <span id="ch1-freq">1000 Hz</span></div>
                        <div class="measurement-item">CH1 Vpp: <span id="ch1-vpp">10.0 V</span></div>
                        <div class="measurement-item">CH2 Freq: <span id="ch2-freq">1000 Hz</span></div>
                        <div class="measurement-item">CH2 Vpp: <span id="ch2-vpp">6.32 V</span></div>
                        <div class="measurement-item">Phase Diff: <span id="phase-diff">-45Â°</span></div>
                        <div class="measurement-item">Gain: <span id="gain-db">-3.98 dB</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Panel -->
        <div class="analysis-panel">
            <div class="analysis-title">ðŸ“ˆ Real-Time Circuit Analysis</div>
            <div class="analysis-grid">
                <div class="analysis-card">
                    <div class="analysis-value" id="analysis-gain">-3.98</div>
                    <div class="analysis-label">Gain (dB)</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-value" id="analysis-phase">-45Â°</div>
                    <div class="analysis-label">Phase Shift</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-value" id="analysis-impedance">1.58k</div>
                    <div class="analysis-label">Impedance (Î©)</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-value" id="analysis-resonant">159</div>
                    <div class="analysis-label">Resonant Freq (Hz)</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-value" id="analysis-q">0.63</div>
                    <div class="analysis-label">Quality Factor</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-value" id="analysis-bandwidth">251</div>
                    <div class="analysis-label">3dB Bandwidth (Hz)</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let fgPowerOn = true;
        let dsoPowerOn = true;
        let currentWaveform = 'sine';
        let currentCircuitType = 'rlc';
        let scopeCanvas, scopeCtx;
        let animationId;

        // Initialize canvas
        function initScopeCanvas() {
            scopeCanvas = document.getElementById('scope-canvas');
            if (scopeCanvas) {
                scopeCtx = scopeCanvas.getContext('2d');
                scopeCanvas.width = 300;
                scopeCanvas.height = 250;
                updateScope();
            }
        }

        // Function Generator Controls
        function selectWaveform(type) {
            currentWaveform = type;
            document.querySelectorAll('.wave-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateCircuitAnalysis();
        }

        function toggleFGPower() {
            fgPowerOn = !fgPowerOn;
            const btn = event.target;
            const statusIndicator = btn.querySelector('.status-indicator');
            
            if (fgPowerOn) {
                btn.innerHTML = '<span class="status-indicator status-on"></span>OUTPUT ON';
                document.getElementById('fg-status').textContent = 'ACTIVE';
            } else {
                btn.innerHTML = '<span class="status-indicator status-off"></span>OUTPUT OFF';
                document.getElementById('fg-status').textContent = 'DISABLED';
            }
            updateCircuitAnalysis();
        }

        function toggleDSOPower() {
            dsoPowerOn = !dsoPowerOn;
            const btn = event.target;
            
            if (dsoPowerOn) {
                btn.innerHTML = '<span class="status-indicator status-on"></span>ACQUISITION ON';
                updateScope();
            } else {
                btn.innerHTML = '<span class="status-indicator status-off"></span>ACQUISITION OFF';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
                // Clear scope
                if (scopeCtx) {
                    scopeCtx.fillStyle = '#001122';
                    scopeCtx.fillRect(0, 0, scopeCanvas.width, scopeCanvas.height);
                }
            }
        }

        // Circuit Type Selection
        function selectCircuitType(type) {
            currentCircuitType = type;
            document.querySelectorAll('.component-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateCircuitDisplay();
            updateCircuitAnalysis();
        }

        function updateCircuitDisplay() {
            const circuitType = document.getElementById('circuit-type');
            const circuitValues = document.getElementById('circuit-values');
            const R = parseFloat(document.getElementById('resistance-slider').value);
            const L = parseFloat(document.getElementById('inductance-slider').value);
            const C = parseFloat(document.getElementById('capacitance-slider').value);
            
            switch (currentCircuitType) {
                case 'rlc':
                    circuitType.textContent = 'RLC Series Circuit';
                    circuitValues.textContent = `R=${R}Î©, L=${L}mH, C=${C}Î¼F`;
                    break;
                case 'rc':
                    circuitType.textContent = 'RC Low-Pass Filter';
                    circuitValues.textContent = `R=${R}Î©, C=${C}Î¼F`;
                    break;
                case 'rl':
                    circuitType.textContent = 'RL High-Pass Filter';
                    circuitValues.textContent = `R=${R}Î©, L=${L}mH`;
                    break;
            }
        }

        // Circuit Analysis
        function updateCircuitAnalysis() {
            if (!fgPowerOn) {
                // Clear all measurements when FG is off
                updateMeasurements(0, 0, 0, 0, 0, 0);
                return;
            }

            const frequency = parseFloat(document.getElementById('freq-slider').value);
            const amplitude = parseFloat(document.getElementById('amp-slider').value);
            const R = parseFloat(document.getElementById('resistance-slider').value);
            const L = parseFloat(document.getElementById('inductance-slider').value) * 1e-3; // Convert to H
            const C = parseFloat(document.getElementById('capacitance-slider').value) * 1e-6; // Convert to F
            
            const omega = 2 * Math.PI * frequency;
            let impedance, phase, outputAmplitude, gain;
            
            switch (currentCircuitType) {
                case 'rlc':
                    const XL = omega * L;
                    const XC = 1 / (omega * C);
                    const X = XL - XC;
                    impedance = Math.sqrt(R * R + X * X);
                    phase = Math.atan2(X, R) * 180 / Math.PI;
                    const resonantFreq = 1 / (2 * Math.PI * Math.sqrt(L * C));
                    const Q = resonantFreq * L / R;
                    const bandwidth = resonantFreq / Q;
                    
                    // Update theoretical displays
                    document.getElementById('resonant-freq').textContent = resonantFreq.toFixed(0) + ' Hz';
                    document.getElementById('analysis-resonant').textContent = resonantFreq.toFixed(0);
                    document.getElementById('analysis-q').textContent = Q.toFixed(2);
                    document.getElementById('analysis-bandwidth').textContent = bandwidth.toFixed(0);
                    break;
                    
                case 'rc':
                    const XC_rc = 1 / (omega * C);
                    impedance = Math.sqrt(R * R + XC_rc * XC_rc);
                    phase = -Math.atan2(XC_rc, R) * 180 / Math.PI;
                    const fc_rc = 1 / (2 * Math.PI * R * C);
                    document.getElementById('resonant-freq').textContent = fc_rc.toFixed(0) + ' Hz (Cutoff)';
                    break;
                    
                case 'rl':
                    const XL_rl = omega * L;
                    impedance = Math.sqrt(R * R + XL_rl * XL_rl);
                    phase = Math.atan2(XL_rl, R) * 180 / Math.PI;
                    const fc_rl = R / (2 * Math.PI * L);
                    document.getElementById('resonant-freq').textContent = fc_rl.toFixed(0) + ' Hz (Cutoff)';
                    break;
            }
            
            // Calculate transfer function (assuming voltage divider for output)
            outputAmplitude = amplitude * (R / impedance);
            gain = 20 * Math.log10(outputAmplitude / amplitude);
            
            // Update displays
            document.getElementById('impedance').textContent = (impedance / 1000).toFixed(2) + ' kÎ©';
            document.getElementById('phase-angle').textContent = phase.toFixed(1) + 'Â°';
            
            updateMeasurements(frequency, amplitude, frequency, outputAmplitude, phase, gain);
            updateAnalysisCards(gain, phase, impedance);
            
            if (dsoPowerOn) {
                updateScope();
            }
        }

        function updateMeasurements(ch1Freq, ch1Amp, ch2Freq, ch2Amp, phaseDiff, gainDb) {
            document.getElementById('ch1-freq').textContent = ch1Freq.toFixed(0) + ' Hz';
            document.getElementById('ch1-vpp').textContent = (ch1Amp * 2).toFixed(1) + ' V';
            document.getElementById('ch2-freq').textContent = ch2Freq.toFixed(0) + ' Hz';
            document.getElementById('ch2-vpp').textContent = (ch2Amp * 2).toFixed(1) + ' V';
            document.getElementById('phase-diff').textContent = phaseDiff.toFixed(1) + 'Â°';
            document.getElementById('gain-db').textContent = gainDb.toFixed(2) + ' dB';
        }

        function updateAnalysisCards(gain, phase, impedance) {
            document.getElementById('analysis-gain').textContent = gain.toFixed(2);
            document.getElementById('analysis-phase').textContent = phase.toFixed(1) + 'Â°';
            document.getElementById('analysis-impedance').textContent = (impedance / 1000).toFixed(2) + 'k';
        }

        // Oscilloscope Display
        function updateScope() {
            if (!dsoPowerOn || !scopeCtx) return;
            
            // Clear canvas
            scopeCtx.fillStyle = '#001122';
            scopeCtx.fillRect(0, 0, scopeCanvas.width, scopeCanvas.height);
            
            // Draw grid
            drawGrid();
            
            if (fgPowerOn) {
                drawWaveforms();
            }
            
            if (dsoPowerOn) {
                animationId = requestAnimationFrame(updateScope);
            }
        }

        function drawGrid() {
            scopeCtx.strokeStyle = '#003366';
            scopeCtx.lineWidth = 1;
            
            // Vertical lines
            for (let x = 30; x < scopeCanvas.width; x += 30) {
                scopeCtx.beginPath();
                scopeCtx.moveTo(x, 0);
                scopeCtx.lineTo(x, scopeCanvas.height);
                scopeCtx.stroke();
            }
            
            // Horizontal lines
            for (let y = 25; y < scopeCanvas.height; y += 25) {
                scopeCtx.beginPath();
                scopeCtx.moveTo(0, y);
                scopeCtx.lineTo(scopeCanvas.width, y);
                scopeCtx.stroke();
            }
            
            // Center lines
            scopeCtx.strokeStyle = '#006699';
            scopeCtx.lineWidth = 2;
            scopeCtx.beginPath();
            scopeCtx.moveTo(0, scopeCanvas.height / 2);
            scopeCtx.lineTo(scopeCanvas.width, scopeCanvas.height / 2);
            scopeCtx.stroke();
        }

        function drawWaveforms() {
            const frequency = parseFloat(document.getElementById('freq-slider').value);
            const amplitude = parseFloat(document.getElementById('amp-slider').value);
            const offset = parseFloat(document.getElementById('offset-slider').value);
            const timebase = parseFloat(document.getElementById('timebase-slider').value);
            const ch1Scale = parseFloat(document.getElementById('ch1-scale').value);
            const ch2Scale = parseFloat(document.getElementById('ch2-scale').value);
            
            // Get circuit response
            const { outputAmplitude, phase } = getCircuitResponse();
            
            const centerY = scopeCanvas.height / 2;
            const cycles = 4;
            const phaseShiftRadians = phase * Math.PI / 180;
            const timeOffset = Date.now() * 0.002; // For animation
            
            // Draw input signal (CH1)
            scopeCtx.strokeStyle = '#00ff00';
            scopeCtx.lineWidth = 2;
            scopeCtx.beginPath();
            
            for (let x = 0; x < scopeCanvas.width; x++) {
                const t = (x / scopeCanvas.width) * cycles * 2 * Math.PI + timeOffset;
                let y = centerY;
                
                if (currentWaveform === 'sine') {
                    y = centerY - ((amplitude / ch1Scale) * 25 * Math.sin(t)) - ((offset / ch1Scale) * 25);
                } else if (currentWaveform === 'square') {
                    y = centerY - ((amplitude / ch1Scale) * 25 * Math.sign(Math.sin(t))) - ((offset / ch1Scale) * 25);
                } else if (currentWaveform === 'triangle') {
                    const phase = t % (2 * Math.PI);
                    const triangleValue = phase < Math.PI ? (2 * phase / Math.PI - 1) : (3 - 2 * phase / Math.PI);
                    y = centerY - ((amplitude / ch1Scale) * 25 * triangleValue) - ((offset / ch1Scale) * 25);
                }
                
                if (x === 0) {
                    scopeCtx.moveTo(x, y);
                } else {
                    scopeCtx.lineTo(x, y);
                }
            }
            scopeCtx.stroke();
            
            // Draw output signal (CH2)
            scopeCtx.strokeStyle = '#ff6600';
            scopeCtx.lineWidth = 2;
            scopeCtx.beginPath();
            
            for (let x = 0; x < scopeCanvas.width; x++) {
                const t = (x / scopeCanvas.width) * cycles * 2 * Math.PI + timeOffset + phaseShiftRadians;
                let y = centerY;
                
                if (currentWaveform === 'sine') {
                    y = centerY - ((outputAmplitude / ch2Scale) * 25 * Math.sin(t));
                } else if (currentWaveform === 'square') {
                    y = centerY - ((outputAmplitude / ch2Scale) * 25 * Math.sign(Math.sin(t)));
                } else if (currentWaveform === 'triangle') {
                    const phase = t % (2 * Math.PI);
                    const triangleValue = phase < Math.PI ? (2 * phase / Math.PI - 1) : (3 - 2 * phase / Math.PI);
                    y = centerY - ((outputAmplitude / ch2Scale) * 25 * triangleValue);
                }
                
                if (x === 0) {
                    scopeCtx.moveTo(x, y);
                } else {
                    scopeCtx.lineTo(x, y);
                }
            }
            scopeCtx.stroke();
        }

        function getCircuitResponse() {
            const frequency = parseFloat(document.getElementById('freq-slider').value);
            const amplitude = parseFloat(document.getElementById('amp-slider').value);
            const R = parseFloat(document.getElementById('resistance-slider').value);
            const L = parseFloat(document.getElementById('inductance-slider').value) * 1e-3;
            const C = parseFloat(document.getElementById('capacitance-slider').value) * 1e-6;
            
            const omega = 2 * Math.PI * frequency;
            let outputAmplitude, phase;
            
            switch (currentCircuitType) {
                case 'rlc':
                    const XL = omega * L;
                    const XC = 1 / (omega * C);
                    const X = XL - XC;
                    const impedance = Math.sqrt(R * R + X * X);
                    outputAmplitude = amplitude * (R / impedance);
                    phase = Math.atan2(X, R) * 180 / Math.PI;
                    break;
                    
                case 'rc':
                    const XC_rc = 1 / (omega * C);
                    const impedance_rc = Math.sqrt(R * R + XC_rc * XC_rc);
                    outputAmplitude = amplitude * (XC_rc / impedance_rc);
                    phase = -Math.atan2(XC_rc, R) * 180 / Math.PI;
                    break;
                    
                case 'rl':
                    const XL_rl = omega * L;
                    const impedance_rl = Math.sqrt(R * R + XL_rl * XL_rl);
                    outputAmplitude = amplitude * (R / impedance_rl);
                    phase = Math.atan2(XL_rl, R) * 180 / Math.PI;
                    break;
            }
            
            return { outputAmplitude, phase };
        }

        // Event Listeners
        function setupEventListeners() {
            // Function generator controls
            document.getElementById('freq-slider').addEventListener('input', function() {
                document.getElementById('freq-display').textContent = this.value + ' Hz';
                updateCircuitAnalysis();
            });
            
            document.getElementById('amp-slider').addEventListener('input', function() {
                document.getElementById('amp-display').textContent = parseFloat(this.value).toFixed(1) + ' V';
                updateCircuitAnalysis();
            });
            
            document.getElementById('offset-slider').addEventListener('input', function() {
                document.getElementById('offset-display').textContent = parseFloat(this.value).toFixed(1) + ' V';
                updateCircuitAnalysis();
            });
            
            // Circuit component controls
            document.getElementById('resistance-slider').addEventListener('input', function() {
                document.getElementById('resistance-display').textContent = this.value + ' Î©';
                updateCircuitDisplay();
                updateCircuitAnalysis();
            });
            
            document.getElementById('inductance-slider').addEventListener('input', function() {
                document.getElementById('inductance-display').textContent = parseFloat(this.value).toFixed(1) + ' mH';
                updateCircuitDisplay();
                updateCircuitAnalysis();
            });
            
            document.getElementById('capacitance-slider').addEventListener('input', function() {
                document.getElementById('capacitance-display').textContent = parseFloat(this.value).toFixed(2) + ' Î¼F';
                updateCircuitDisplay();
                updateCircuitAnalysis();
            });
            
            // Oscilloscope controls
            document.getElementById('timebase-slider').addEventListener('input', function() {
                document.getElementById('timebase-value').textContent = this.value + ' Î¼s/div';
                document.getElementById('timebase-display').textContent = this.value + 'Î¼s/div';
            });
            
            document.getElementById('ch1-scale').addEventListener('input', function() {
                document.getElementById('ch1-scale-display').textContent = parseFloat(this.value).toFixed(1) + ' V/div';
            });
            
            document.getElementById('ch2-scale').addEventListener('input', function() {
                document.getElementById('ch2-scale-display').textContent = parseFloat(this.value).toFixed(1) + ' V/div';
            });
        }

        // Initialize everything
        window.addEventListener('load', function() {
            initScopeCanvas();
            setupEventListeners();
            updateCircuitDisplay();
            updateCircuitAnalysis();
        });
    </script>
</body>
</html>
